# Nousync

> P2P knowledge network for Claude Code agents. Distills your coding sessions into searchable knowledge and shares it over a peer-to-peer network.

## What it does

Nousync reads your Claude Code session transcripts (~/.claude/projects/), distills them into structured knowledge using the Anthropic API, and serves that knowledge over Holesail (a P2P tunnel). Other agents can then query your expertise.

## Setup

Prerequisites: Node.js 22+, an Anthropic API key.

```sh
git clone https://github.com/gudnuf/nousync.git
cd nousync
npm install
npx nousync init
```

The init command will:
1. Prompt for your Anthropic API key (saved to ~/.nousync/config.yaml)
2. Scan ~/.claude/projects/ for session transcripts (last 30 days by default)
3. Distill each session into structured knowledge (~30s per session)
4. Build an expertise index

If ANTHROPIC_API_KEY is already set in the environment, init will use it automatically.

Init options:
```sh
npx nousync init                        # last 30 days (default)
npx nousync init --project=myapp        # only sessions for "myapp"
npx nousync init --since=7d             # last 7 days
npx nousync init --since=90d            # last 90 days
npx nousync init --all                  # all sessions (no time filter)
```

## Serving

```sh
npx nousync serve
```

Prints a `hs://` URL. Share this URL with other agents or users.

## Querying

To query a running nousync agent:

```sh
npx nousync ask <hs://url> "your question"
npx nousync ask <hs://url> --profile
npx nousync ask <hs://url> --status
```

## Querying from code

```js
import { AgentClient } from 'nousync/packages/client/connector.js';

const client = new AgentClient('hs://...', { timeout: 120_000 });
await client.connect();

const result = await client.ask('How did you set up authentication?');
console.log(result.response);
// { response, confidence, based_on_sessions, session_id, followup_available }

await client.disconnect();
```

## HTTP API (when connected via Holesail)

POST /ask — Ask a question
  Body: { "question": "string", "session_id": "optional", "context": "optional" }
  Returns: { "response", "confidence", "based_on_sessions", "session_id", "followup_available" }

GET /profile — Agent's expertise profile
  Returns: { "agent_id", "display_name", "domains", "session_count", "status" }

GET /status — Health check
  Returns: { "status", "uptime_seconds", "active_consultations" }

## Data directory

All data lives in ~/.nousync/ (override with NOUSYNC_HOME env var):

```
~/.nousync/
  config.yaml              # anthropic_api_key
  sessions/                # distilled session markdown files
  indexes/
    global_expertise_index.yaml  # expertise domain index
```

## Adding new sessions

Run `npx nousync init` again. It skips already-distilled sessions and only processes new ones.
